# Configuración del Sistema de Votación Sindical basado en Blockchain
# Proyecto TFG - Enrique Huet Adrover
# Java 21 + Spring Boot 3.5.7 + Hyperledger Fabric

server:
  port: 8080
  servlet:
    context-path: /api/v1

spring:
  application:
    name: votacion-blockchain-backend

  # Configuración de CORS para desarrollo
  web:
    cors:
      allowed-origins:
        - "http://localhost:4200"
        - "http://127.0.0.1:4200"
      allowed-methods:
        - GET
        - POST
        - PUT
        - DELETE
        - OPTIONS
      allowed-headers: "*"
      allow-credentials: true
      max-age: 3600

  # Configuración de JSON
  jackson:
    default-property-inclusion: non_null
    serialization:
      write-dates-as-timestamps: false
      indent-output: true
    deserialization:
      fail-on-unknown-properties: false

  # Configuración de Security (deshabilitamos funciones no necesarias para PoC)
  security:
    require-ssl: false

# Configuración de Hyperledger Fabric
fabric:
  # Ruta al perfil de conexión de la organización
  connection-profile: "/home/ehuetadr/TFG/VotacionBC/fabric/test-network/organizations/peerOrganizations/org1.example.com/connection-org1.json"

  # Ruta del wallet donde se almacenan las identidades
  wallet-path: "/home/ehuetadr/TFG/VotacionBC/backend-spring/wallet"

  # Usuario de aplicación para conectar con Fabric
  user: "appUser"

  # Canal de la red Fabric donde está desplegado el chaincode
  channel: "electionchannel"

  # Nombre del chaincode de elecciones
  chaincode: "electioncc"

  # Configuración de timeouts (en segundos)
  timeouts:
    connection: 30
    transaction: 60
    query: 10

  # Configuración de retry para operaciones blockchain
  retry:
    max-attempts: 3
    backoff-delay-ms: 1000

# Configuración de almacenamiento cifrado off-chain
storage:
  # Directorio base para almacenar blobs cifrados
  base-path: "/home/ehuetadr/TFG/VotacionBC/backend-spring/data/storage"

  # Ruta al keystore con las claves de cifrado
  keystore-path: "/home/ehuetadr/TFG/VotacionBC/backend-spring/src/main/resources/keystore/keystore.json"

  # Configuración de cifrado AES-GCM
  encryption:
    algorithm: "AES/GCM/NoPadding"
    key-length: 256
    iv-length: 12
    tag-length: 128

  # Configuración de limpieza automática
  cleanup:
    enabled: true
    retention-days: 30

# Configuración de autenticación mock (simula Azure EntraID)
auth:
  # Ruta al archivo con usuarios mock
  users-file: "/home/ehuetadr/TFG/VotacionBC/backend-spring/src/main/resources/mock/users.json"

  # Configuración JWT simulada
  jwt:
    secret: "mock-secret-for-poc-development-only-do-not-use-in-production"
    expiration: 3600 # 1 hora en segundos
    issuer: "votacion-blockchain-poc"
    audience: "voting-system"

  # Roles permitidos en el sistema
  roles:
    - "voter" # Empleado que puede votar
    - "admin" # Administrador de elecciones
    - "auditor" # Auditor externo

# Configuración específica de elecciones
elections:
  # Configuración por defecto para nuevas elecciones
  default-config:
    voting-duration-hours: 24
    max-votes-per-user: 1
    allow-vote-modification: false
    require-audit-trail: true

  # Configuración de validación
  validation:
    min-title-length: 5
    max-title-length: 100
    min-description-length: 10
    max-description-length: 500
    min-options: 2
    max-options: 10

  # Configuración de notificaciones (mock)
  notifications:
    email-enabled: false
    sms-enabled: false

# Configuración de logging
logging:
  level:
    es.tfg.votacion: DEBUG
    org.hyperledger.fabric: INFO
    org.springframework.security: INFO
    org.springframework.web.cors: DEBUG
    org.springframework.transaction: DEBUG
  pattern:
    console: "%clr(%d{yyyy-MM-dd HH:mm:ss.SSS}){faint} %clr(%5p) %clr(${PID:- }){magenta} %clr(---){faint} %clr([%15.15t]){faint} %clr(%-40.40logger{39}){cyan} %clr(:){faint} %m%n%wEx"
    file: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: "/home/ehuetadr/TFG/VotacionBC/backend-spring/logs/application.log"
    max-size: "10MB"
    max-history: 30

# Configuración de performance y threading (Java 21 Virtual Threads)
spring.threads.virtual.enabled: true

# Métricas y monitoreo para desarrollo
management:
  endpoints:
    web:
      exposure:
        include: "health,info,metrics,loggers,env"
      base-path: "/actuator"
  endpoint:
    health:
      show-details: when_authorized
      show-components: always
    info:
      enabled: true
    metrics:
      enabled: true
  info:
    env:
      enabled: true
    java:
      enabled: true
    os:
      enabled: true
  metrics:
    export:
      simple:
        enabled: true

# Información de la aplicación
info:
  app:
    name: "application"
    version: "0.0.1-SNAPSHOT"
    description: "Sistema de Votación Sindical basado en Blockchain - TFG"
    author: "Enrique Huet Adrover"
    java-version: "21.0.8"
  build:
    artifact: "votacion"
    group: "es.tfg"
