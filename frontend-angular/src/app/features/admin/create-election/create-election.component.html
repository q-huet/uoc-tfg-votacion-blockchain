<div class="create-election-container">
  <p-toast></p-toast>

  <p-card header="Crear Nueva Elección">
    <form [formGroup]="electionForm" (ngSubmit)="onSubmit()">

      <div class="field">
        <label for="title" class="block font-bold mb-2">Título</label>
        <input id="title" type="text" pInputText formControlName="title" class="w-full" />
        <small class="p-error block" *ngIf="electionForm.get('title')?.invalid && electionForm.get('title')?.touched">
          El título es requerido (5-100 caracteres)
        </small>
      </div>

      <div class="field mt-3">
        <label for="description" class="block font-bold mb-2">Descripción</label>
        <textarea id="description" pInputTextarea formControlName="description" class="w-full" rows="3"></textarea>
        <small class="p-error block" *ngIf="electionForm.get('description')?.invalid && electionForm.get('description')?.touched">
          La descripción es requerida (10-500 caracteres)
        </small>
      </div>

      <div class="formgrid grid mt-3">
        <div class="field col-12 md:col-6">
          <label for="startTime" class="block font-bold mb-2">Fecha de Inicio</label>
          <p-calendar inputId="startTime" formControlName="startTime" [showTime]="true" [showIcon]="true" styleClass="w-full"></p-calendar>
          <small class="p-error block" *ngIf="electionForm.get('startTime')?.invalid && electionForm.get('startTime')?.touched">
            Fecha de inicio requerida
          </small>
        </div>
        <div class="field col-12 md:col-6">
          <label for="endTime" class="block font-bold mb-2">Fecha de Fin</label>
          <p-calendar inputId="endTime" formControlName="endTime" [showTime]="true" [showIcon]="true" styleClass="w-full"></p-calendar>
          <small class="p-error block" *ngIf="electionForm.get('endTime')?.invalid && electionForm.get('endTime')?.touched">
            Fecha de fin requerida
          </small>
        </div>
      </div>

      <p-divider align="center">
        <span class="p-tag">Opciones de Voto</span>
      </p-divider>

      <div formArrayName="options">
        <div *ngFor="let option of options.controls; let i=index" [formGroupName]="i" class="option-item mb-3 p-3 border-1 surface-border border-round">
          <div class="flex justify-content-between align-items-center mb-2">
            <span class="font-bold">Opción {{i + 1}}</span>
            <button pButton icon="pi pi-trash" class="p-button-danger p-button-text p-button-sm"
                    (click)="removeOption(i)" [disabled]="options.length <= 2" type="button"></button>
          </div>

          <div class="field">
            <input type="text" pInputText formControlName="title" placeholder="Título de la opción" class="w-full mb-2" />
          </div>
          <div class="field">
            <input type="text" pInputText formControlName="description" placeholder="Descripción (opcional)" class="w-full" />
          </div>
        </div>
      </div>

      <div class="flex justify-content-center mt-3">
        <button pButton label="Añadir Opción" icon="pi pi-plus" class="p-button-outlined" (click)="addOption()" type="button"></button>
      </div>

      <div class="flex justify-content-end mt-5 gap-2">
        <button pButton label="Cancelar" class="p-button-secondary" routerLink="/admin" type="button"></button>
        <button pButton label="Crear Elección" icon="pi pi-check" class="p-button-success" type="submit" [loading]="loading"></button>
      </div>

    </form>
  </p-card>
</div>
